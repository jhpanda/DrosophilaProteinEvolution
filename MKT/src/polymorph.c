
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include <omp.h>
#include "fasta.h"
#include "polymorph.h"

char NT[] = "ACGT";

int n_tbl[] = { 0,1,0,1,1,1,1,1,1,2,1,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,1,1,2,2,2,2,
1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,0,2,2,2,2,2,0,3,2,3,2,2,2,2,1,0,1,0,1,1,1,1,
2,1,2,1,1,1,2,1,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,
0,1,0,1,2,2,2,2,0,2,3,2,2,2,3,2,0,1,0,1,1,1,1,1,1,2,1,2,1,2,1,2,1,2,1,2,2,2,2,2,
1,1,1,1,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,0,2,0,2,2,2,2,2,0,3,2,3,2,3,2,3,
1,0,1,0,1,1,1,1,2,1,2,1,1,1,2,1,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,
2,2,2,2,2,2,2,2,0,1,0,1,2,2,2,2,0,2,3,2,2,2,3,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,
2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,
0,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,1,2,1,2,2,2,2,2,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,
1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,
1,2,1,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,
1,2,1,2,1,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,
1,1,1,1,2,2,2,2,0,3,0,3,2,2,2,2,0,2,1,2,2,2,2,2,2,1,2,1,1,1,1,1,1,0,1,0,1,1,2,1,
2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,2,0,2,2,2,2,2,
0,1,2,1,2,2,3,2,1,2,1,2,1,1,1,1,0,1,0,1,1,2,1,2,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,
2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,3,0,3,2,2,2,2,0,2,1,2,2,3,2,3,2,1,2,1,1,1,1,1,
1,0,1,0,1,1,2,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,
0,2,0,2,2,2,2,2,0,1,2,1,2,2,3,2,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,0,2,2,2,2,2,2,2,2,
1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,2,2,2,2,0,2,2,2,1,1,1,1,
1,1,2,1,1,1,1,1,1,1,2,1,0,0,1,0,2,2,2,2,2,2,2,2,1,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,0,2,0,2,2,2,2,2,0,2,3,2,1,1,2,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,0,1,
2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,3,0,3,2,2,2,2,
0,3,2,3,1,2,1,2,1,1,2,1,1,1,1,1,1,1,2,1,0,0,1,0,2,2,2,2,2,2,2,2,1,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,2,2,2,2,0,2,3,2,1,1,2,1,1,2,1,2,2,2,2,2,
1,2,1,2,2,2,2,2,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,
0,2,0,2,2,2,2,2,0,2,2,2,1,2,1,2,2,1,2,1,2,2,2,2,1,2,1,2,2,2,2,2,1,0,1,0,1,1,1,1,
1,1,1,1,1,1,1,1,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,0,1,0,1,2,2,2,2,0,2,2,2,1,2,1,2,
1,2,1,2,2,2,2,2,1,2,1,2,2,2,2,2,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,1,2,2,2,2,2,
2,2,2,2,2,2,2,2,0,2,0,2,2,2,2,2,0,2,2,2,1,2,1,2,2,1,2,1,2,2,2,2,1,2,1,2,2,2,2,2,
1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,0,1,0,1,2,2,2,2,
0,2,2,2,1,2,1,2,2,2,2,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,0,2,2,2,1,2,1,2,2,2,2,2,1,1,1,1,
1,2,1,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
0,2,0,2,1,1,1,1,0,2,2,2,1,2,1,2,2,2,2,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,1,1,0,0,0,0,
1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,0,2,2,2,1,2,1,2,
2,2,2,2,1,1,1,1,1,2,1,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,0,2,0,2,1,1,1,1,0,2,2,2,1,2,1,2,1,2,1,2,1,1,1,1,0,1,0,1,1,1,1,1,
1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,2,0,2,2,2,2,2,
0,1,1,1,1,2,1,2,1,2,1,2,1,2,1,2,0,1,0,1,1,2,1,2,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,
2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,2,0,2,2,2,2,2,0,1,1,1,1,2,1,2,1,2,1,2,1,1,1,1,
0,1,0,1,1,2,1,2,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,
0,2,0,2,2,2,2,2,0,1,1,1,1,2,1,2,1,2,1,2,1,2,1,2,0,1,0,1,1,2,1,2,1,1,1,1,1,1,1,1,
0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,2,0,2,2,2,2,2,0,1,1,1,1,2,1,2,
2,2,2,2,2,2,2,2,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,0,2,0,2,1,1,1,1,0,2,1,2,0,1,0,1,2,2,2,2,2,2,2,2,1,2,1,2,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,1,2,1,2,
0,2,1,2,0,1,0,1,2,2,2,2,2,2,2,2,1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,1,1,1,1,0,2,1,2,0,1,0,1,2,2,2,2,2,2,2,2,
1,2,1,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
0,2,0,2,1,2,1,2,0,2,1,2,0,1,0,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,
2,2,2,2,2,2,2,2,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,2,0,2,2,2,2,2,0,2,2,2,2,2,2,2,
2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,0,1,0,1,1,1,1,
1,1,1,1,1,1,1,1,0,1,0,1,2,2,2,2,0,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,
1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,0,2,0,2,2,2,2,2,
0,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,
1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,2,2,2,2,0,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,
0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,
1,1,1,1,1,1,1,1,0,2,0,2,1,1,1,1,0,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,0,2,0,2,1,1,1,1,
0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,
1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,2,0,2,2,2,2,2,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,
1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,
0,2,0,2,2,2,2,2,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,
1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,0,2,0,2,2,2,2,2,0,1,1,1,2,2,2,2,
2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,1,1,1,1,
0,0,0,0,1,1,1,1,0,2,0,2,2,2,2,2,0,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,2,0,2,2,2,2,2,
0,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,2,0,2,2,2,2,2,0,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
0,2,0,2,2,2,2,2,0,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,2,0,2,2,2,2,2,0,2,2,2,1,1,1,1,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,1,2,2,2,2,3,2,3,2,2,2,3,2,
2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,0,0,0,0,1,1,1,1,
0,1,2,1,2,1,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1,2,1,2,2,2,2,
3,2,3,2,2,2,3,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,
0,0,0,0,1,1,1,1,0,1,2,1,2,1,2,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,1,0,1,0,0,0,0,0,1,1,1,1,1,1,1,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,1,2,1,2,2,2,2,2,1,1,1,1,
2,2,2,2,2,2,2,2,0,1,0,1,0,0,0,0,0,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,1,0,1,0,0,0,0,
0,1,1,1,1,1,1,1,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,1,2,1,2,
2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,0,1,0,1,0,0,0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,2,3,2,2,2,2,2,2,1,2,1,2,2,3,2,2,2,2,2,2,2,2,2,
1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,1,0,1,1,1,1,1,0,0,1,0,2,1,2,1,
2,3,2,3,2,2,2,2,1,2,1,2,2,3,2,3,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,
1,1,1,1,2,2,2,2,0,2,0,2,1,1,1,1,1,1,0,1,1,2,1,2,3,2,3,2,2,2,2,2,2,1,2,1,2,2,3,2,
2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,0,1,0,1,1,1,1,1,
0,0,1,0,2,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,
2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,1,1,1,1,0,2,1,2,0,1,0,1,2,2,3,2,2,2,2,2,
2,2,3,2,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,
0,1,0,1,1,1,1,1,0,1,2,1,1,0,1,0,2,3,2,3,2,2,2,2,2,3,2,3,1,2,1,2,1,1,1,1,1,1,1,1,
1,1,1,1,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,0,2,0,2,1,1,1,1,0,2,1,2,0,1,0,1,
2,2,3,2,2,2,2,2,2,2,3,2,1,1,2,1,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,2,2,2,2,2,2,2,2,
2,2,2,2,1,1,1,1,0,1,0,1,1,1,1,1,0,1,2,1,1,0,1,0 };

int s_tbl[] = { 0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,1,2,2,2,0,1,1,1,
0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,0,1,1,0,1,1,
0,0,0,1,1,0,0,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,
0,0,0,1,1,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,1,0,0,0,1,1,0,1,
2,2,1,2,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,0,0,0,0,1,0,0,0,
0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,
1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,1,2,2,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,
0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,2,0,2,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,2,2,1,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
2,1,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,
0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,0,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,
0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,2,2,1,2,2,2,1,2,2,2,1,2,2,2,1,2,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,0,
0,1,0,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,
1,2,2,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,
1,0,0,1,1,0,1,1,1,0,0,1,1,0,0,1,1,0,1,1,1,0,1,1,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,
1,1,0,1,1,1,0,1,2,2,1,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,
0,0,0,0,1,0,0,0,1,1,0,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,0,2,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,0,0,1,0,0,1,1,1,
1,1,2,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,
0,0,0,0,0,1,1,1,0,1,1,1,1,1,2,1,0,0,0,1,1,0,1,1,2,0,2,1,1,0,1,1,0,0,0,1,1,0,1,1,
1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,2,0,2,1,
1,0,0,0,1,1,0,1,2,1,1,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,
1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,0,1,0,1,2,1,1,1,0,1,0,0,1,1,1,0,2,1,2,0,1,1,1,0,
0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,
0,1,1,0,2,1,2,0,0,1,1,1,0,1,1,1,1,1,2,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,1,1,2,1,1,0,1,1,1,0,1,1,
2,0,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
0,0,0,1,1,0,1,1,0,0,1,1,2,0,2,1,1,1,0,1,1,1,0,1,2,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,2,1,1,1,
1,1,1,0,1,1,1,0,2,1,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,2,1,2,0,1,1,2,1,1,2,2,2,1,1,2,1,1,2,2,2,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,
0,1,1,1,1,1,2,1,2,0,2,1,2,0,2,1,2,0,2,1,2,0,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,2,0,2,1,2,1,1,1,2,2,1,2,
2,1,1,1,2,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
0,1,0,1,1,1,0,1,0,1,0,1,2,1,1,1,2,1,2,0,2,1,2,0,2,1,2,0,2,1,2,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,2,1,2,0,
0,1,1,1,0,1,1,1,1,1,2,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,1,0,1,1,2,2,2,0,1,2,1,1,1,2,1,1,0,1,1,1,0,1,1,2,0,2,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,2,0,2,1,
0,0,2,1,2,0,2,1,1,1,0,1,1,1,0,1,2,1,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,2,2,1,2,0,1,1,1,2,1,1,1,1,1,1,0,1,1,1,0,
2,1,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
0,1,0,0,2,1,2,0,0,1,2,0,2,1,2,0,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,
0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,1,1,1,0,1,1,1,
0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,
1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,
1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,
0,1,0,1,1,1,0,1,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,
0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,
0,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,
0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
0,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,1,1,0,0,1,
0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,
0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1,1,1,0,
0,1,0,0,1,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,
0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,
0,1,1,1,1,2,2,2,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,1,1,0,1,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,2,0,2,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,1,1,0,1,2,2,1,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,1,0,1,1,1,0,1,
0,1,0,1,1,1,0,1,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,2,1,2,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,1,0,1,1,
1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,1,
1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1,0,1,1,1,0,1,2,2,1,2,1,1,0,1,1,1,0,1,
1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,0,0,
1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,
0,1,0,0,0,1,0,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,1,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,
0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,1,1,0,1,1,
1,0,0,1,1,0,0,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,
0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,1,1,0,0,0,1,1,0,1,1,0,0,0,1,0,0,0,2,2,1,2,2,2,1,2,
2,2,1,2,2,2,1,2,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,0,0,0,0,1,1,0,1,0,0,0,0,1,0,0,0,
1,1,0,0,1,1,1,0,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,1,1,1,0,
1,1,1,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,0 };

static int codon_to_index(CODON codon)
{
/* conver codon to it's index in order of "ACGT" */
    int m,idx[3];
    int index = 0;
    int flag  = 0;

    if (strcmp(codon,gaps)==0)
    {
        index = NUMCODON;
    }
    else
    {
        for (m=0;m<DIM;m++)
        {
            if (codon[m] == 'A' || codon[m] == 'a')
            {
                idx[m] = 0;
            }
            else if (codon[m] == 'C' || codon[m] == 'c')
            {
                idx[m] = 1;
            }
            else if (codon[m] == 'G' || codon[m] == 'g')
            {
                idx[m] = 2;
            }
            else if (codon[m] == 'T' || codon[m] == 't')
            {
                idx[m] = 3;
            }
            else
            {
                fprintf(stderr,">Warn: unrecoganized codon %s!\n",codon);
                flag = -1;
            }
        }
        index = 16*idx[0] + 4*idx[1] + idx[2];
    }
    if (flag==0){
        return index;
    }
    else
    {
        return flag;
    }
}

static void major_minor_allele(int *codon_array,long npop,int *idx_major,int *idx_minor,int *n_major,int *n_minor)
{
    /* find the most frequent codon, major allelle 
       Adapted from: https://www.geeksforgeeks.org/c-program-find-second-frequent-character/ 
       The idea is to convert codon to index first and find major/minor index
    */
    int  i,j,k,m,idx;
    int array[65]; /* so that array[65] is '\0' */

    for (i=0;i<NUMCODON;i++)
    {
        array[i] = 0;
    }

    for (i=0;i<npop;i++)
    {
        array[codon_array[i]] ++;
    }

    int idx1 = 0;
    int idx2 = 0;
    for(i=0; i<NUMCODON; i++)
    {
        if( array[i] > array[idx1])
        {
            idx2 = idx1;
            idx1 = i;
        }
        else if(array[i] > array[idx2] && array[i] != array[idx1])
        {
            idx2 = i;
        }
    }

    *idx_major = idx1;
    *idx_minor = idx2;

    *n_major = array[idx1];
    *n_minor = array[idx2];
}

static void index_to_codon(int index,CODON codon)
{
    int i,m;
    int idx[3];

    if (index==NUMCODON)    // "---" index is 64
    {
        for (m=0;m<DIM;m++)
        {
            codon[0] = gap;
        }
    }
    else
    {
        i = index/16;       // other codon index are in order of "ACGT"
        codon[0] = NT[i];   
        index -= i*16;
        i = index/4;
        codon[1] = NT[i];
        index -= i*4;
        codon[2] = NT[index];
    }
    codon[3] = '\0';
}

static char translate(CODON codon)
{
    int idx[DIM];
    int i,j,k,m,index;

    index = codon_to_index(codon);
    if (index>=0)
    {
        return codon_tbl[index];
    }
    else
    {
        return gap;
    }
}

static int dist_codon(CODON codon1,CODON codon2)
{
    int i,k,m,d;
    char t1 = translate(codon1);
    char t2 = translate(codon2);

    d = 0;
    if (t1==t2)
    {
        d = 0;
    }
    else
    {
        d ++;
        for (k=0;k<DIM;k++)
        {
            if (codon1[k]!=codon2[k])
            {
                d ++;
            }
        }
    }
    return d;
}

static int shortest_path(CODON codon1,CODON codon2, CODON codon3)
{
    int d12 = dist_codon(codon1,codon2);
    int d13 = dist_codon(codon1,codon3);
    int d23 = dist_codon(codon2,codon3);
    int d32 = d23;


    if (d12+d23 <= d13+d32) // since codon1 is always the start point
    {                       // thus, there are only two possible paths
        return 1;           // starting from codon1: 
    }                       // (1) 1-->2-->3 
    else                    // (2) 1-->3-->2
    {                       // in our case, codon1 is outgroup codon
        return 2;           // codon2 and codon3 are two alternative codons
    }
}

static int polymorph_site(int icodon,CODON *pop_codon,CODON *out_codon, long npop, int nout, float cutoff, int *ns)
{
    int i,j,k,m;
    int n,s;
    char t0,t_major,t_minor;
    CODON codon0;

    /* initilize ns */
    for (m=0;m<8;m++)
    {
        ns[m] = 0;
    }
    //printf("pop_codon0 %s, out_codon0 %s\n",pop_codon[0],out_codon[0]);

    /* nout can be 1 (unpolarized), or 2 and more (polarized) */
    for (m=0;m<nout;m++)
    {
        /* for polarized MK test, if out_codons not the same, disregard! */
        if (strcmp(out_codon[m],out_codon[0])!=0)
        {
            return 0;
        }
    }
    strcpy(codon0,out_codon[0]);

    /* if outgroup are gaps, ns would be zero */
    for (m=0;m<DIM;m++)
    {
        if (codon0[m]==gap)
        {
            return 0;
        }
    }

    /* if ingroups are gaps, ns would be zero */
    for (i=0;i<npop;i++)
    {
        for (m=0;m<DIM;m++)
        {
            if (pop_codon[i][m]==gap)
            {
                return 0;
            }
        }
    }

    /* compute polymorphism  */
    int   n_major = 0, n_minor = 0;
    int   idx,idx0,idx_major,idx_minor,ip;
    CODON c_major,c_minor,c_ingrp;

    int codon_arr[npop];
    for(i=0;i<npop;i++)
    {
        codon_arr[i] = codon_to_index(pop_codon[i]);
    }

    /* check major and minor allele frequencies to determine if we will compute ns for the site */
    major_minor_allele(codon_arr,npop,&idx_major,&idx_minor,&n_major,&n_minor);

    /* now we need to compare the translation */
    idx0      = codon_to_index(codon0);

    t0 = codon_tbl[idx0];
    t_major = codon_tbl[idx_major];
    t_minor = codon_tbl[idx_minor];

    index_to_codon(idx_major,c_major);
    index_to_codon(idx_minor,c_minor);

    ns[5] = idx_major;
    ns[6] = idx_minor;
    ns[7] = idx0;

    /*
    if (icodon==1101)
    {   
    printf("major %s %d %d, minor %s %d %d, out %s %d\n",c_major,idx_major,n_major,c_minor,idx_minor,n_minor,codon0,idx0);
    }
    */

    /*
    printf("major %s %d %d, minor %s %d %d\n",c_major,idx_major,n_major,c_minor,idx_minor,n_minor);
    */

    if (n_minor>0 && (float) n_minor/npop < cutoff)
    {
        if (idx_major==idx0)
        {
            return 0;
        }
        else
        {
            idx = idx0 + NUMCODON*idx_major;
            n   = n_tbl[idx];
            s   = s_tbl[idx];
            ns[1] = n;
            ns[3] = s;
            ns[4] = n_major;
            return 1;
        }
    }

    if (idx_major==idx_minor || n_minor==0)
    {
        if (idx_major == idx0)
        {
            return 0;
        }
        else
        {
            idx   = idx0 + NUMCODON*idx_major;
            n = n_tbl[idx];
            s = s_tbl[idx];
            ns[1] = n;
            ns[3] = s;
            ns[4] = n_major;
            return 1;
        }
    }

    /* if c_major!=c_minor; it's a polymorph site */
    /* in a rare case (c_major!=out && c_minor!=out), we consider it's fixed */
    else
    {
        if (idx_major == idx0)
        {
            idx   = idx0 + NUMCODON*idx_minor;
            n     = n_tbl[idx];
            s     = s_tbl[idx];
            ns[0] = n;
            ns[2] = s;
            ns[4] = n_minor; //printf("%s %s %d %d %d\n",c_major,c_minor,idx,n_tbl[idx],s_tbl[idx]);
            return 1;
        }
        else if (idx_major!=idx0 && idx_minor==idx0)
        {
            idx   = idx0 + NUMCODON*idx_major;
            n     = n_tbl[idx];
            s     = s_tbl[idx];
            ns[0] = n;
            ns[2] = s;
            ns[4] = n_major;
            return 1;
        }
        else if (idx_major!=idx0 && idx_minor!=idx0)
        {
    
            ip    = shortest_path(codon0,c_major,c_minor); // shortest path
            if (ip==1)  // codon0-->c_major-->c_minor
            {
                idx   = idx0 + NUMCODON*idx_major; // codon0-->c_major
            }
            else        // codon0-->c_minor-->c_major
            {
                idx   = idx0 + NUMCODON*idx_minor; // codon0-->c_minor
            }

            /* ns from codon0 to next */
            n     = n_tbl[idx];
            s     = s_tbl[idx];
            ns[1] = n;
            ns[3] = s;

            /* ns from next to last */
                
            if (ip==1)  // c_major-->c_minor
            {
                idx   = idx_major + NUMCODON*idx_minor; // c_major<-->c_minor
                n     = n_tbl[idx];
                s     = s_tbl[idx];
                ns[0] = n;
                ns[2] = s;
                ns[4] = n_minor;
                return 1;
            }
            else        // c_minor-->c_major
            {
                idx   = idx_major + NUMCODON*idx_minor; // c_major<-->c_minor
                n     = n_tbl[idx];
                s     = s_tbl[idx];
                ns[0] = n;
                ns[2] = s;
                ns[4] = n_major;
                return 1;
            }
        }
    }
}

void cMK_from_fasta(char *fasta_nm,char *name,char **sequence,char **headers,char *ingrp_nm,char **outgrp_nm,int nout,float cutoff,int *MKpolym,float *MKalpha,bool debug)
{
    /*
 *      MKpolym[0] Pn
 *      MKpolym[1] Dn
 *      MKpolym[2] Ps
 *      MKpolym[3] Ds
 *      MKpolym[4] ncodon
 *      MKpolym[5] npop
 *
 *      MKalpha[0] alpha
 *      MKalpha[1] pvalue
    */
    size_t len;
    int  i,read,idx,iseq,seqlen;
    char identifier;
    char header[MINLEN];
    char *str = NULL;

    FILE *fp;

    /*
    */
    int nseq = 0;
    fp = fopen(fasta_nm,"r");
    while ((read = getline(&str, &len, fp))!=-1){
        if (!empty_line(str)) 
        {
            identifier = str[0];
            if (identifier == '>') 
            {
                nseq ++;
            }
        }
    }
    fclose(fp);

    fp = fopen(fasta_nm,"r");
    header[0] = '\0';
    iseq      = 0;
    while ((read = getline(&str, &len, fp))!=-1){
        if (!empty_line(str)) 
        {
            identifier = str[0];
            if (identifier == '>') 
            {
 
                /* a new header means to summarize previous sequence */
                if (iseq>0) 
                {
                    sequence[iseq-1][idx] = '\0';
                }
 
                /* a new header means a new sequence */
                len = strlen(str);
                for (i=0;i<len-2;i++)
                {
                    headers[iseq][i] = str[i+1];
                }
                headers[iseq][i] = '\0';
 
                idx = 0; // initialize the index of each sequence
                iseq ++;
 
            }
            else if (identifier != '>')
            {
                len = strlen(str);
                for (i=0;i<len-1;i++)
                {
                    sequence[iseq-1][idx] = str[i];
                    idx ++;
                } 
            }
        }
    }
    /* don't forget the last sequence */
    sequence[iseq-1][idx] = '\0';// make sure seq ends
    seqlen = idx;
    
    fclose(fp);


    /* now polymorphism */
    int j,k,m,n,flag;
    int polym[8];
    int Pn,Dn,Ps,Ds;
    char refname[MINLEN];
    char outname[MINLEN];
    sprintf(refname,"%s_0",ingrp_nm);

    /*
    ncodon = seqlen/DIM;
    ncodon = 5;
    */

    if (seqlen%DIM!=0)
    {
        fprintf(stderr,">ERROR: %s not multiple of 3\n",fasta_nm);
        exit(1);
    }

    CODON pop_codon[MAXLEN];
    CODON out_codon[MINLEN];

    for (m=0;m<6;m++)
    {
        MKpolym[m] = 0;
    }
    MKpolym[m] = '\0';
    for (m=0;m<2;m++)
    {
        MKalpha[m] = 0.;
    }
    MKalpha[m] = '\0';

    /*
    */

    idx    = 0;
    for (n=0;n<seqlen/DIM;n++)
    {

        idx = 0;
        for (i=0;i<nseq;i++)
        {
            if (strncmp(headers[i],ingrp_nm,strlen(ingrp_nm))==0 && strcmp(headers[i],refname)!=0)
            {
                /*
                printf("%s %d\n",headers[i],m);
                */
                for (j=0;j<DIM;j++)
                {
                    pop_codon[idx][j] = sequence[i][3*n+j];
                }
                pop_codon[idx][j] = '\0';
                idx ++;
            }
            else
            {
                /*
                printf("%s %s\n",headers[i],outgrp_nm[0]);
                */
                for (k=0;k<nout;k++) 
                {
                    sprintf(outname,"%s_0",outgrp_nm[k]);
                    if (strcmp(headers[i],outgrp_nm[k])==0 || strcmp(headers[i],outname)==0)
                    {
                        for (j=0;j<DIM;j++)
                        {
                            out_codon[k][j] = sequence[i][3*n+j];
                        }
                        out_codon[k][j] = '\0';
                    }
                }
            }
        }
        flag = polymorph_site(n,pop_codon,out_codon,idx,nout,cutoff,polym);

        if (debug && flag)
        {
            CODON c_major,c_minor,codon0;
            char t_major,t_minor,t0;
            index_to_codon(polym[5],c_major);
            index_to_codon(polym[6],c_minor);
            index_to_codon(polym[7],codon0);
            t_major = translate(c_major);
            t_minor = translate(c_minor);
            t0      = translate(codon0);
            printf("%s_%d %d %d %d %d %d %d %s %s %s %c %c %c\n",name,n,idx,polym[0],polym[1],polym[2],polym[3],polym[4],codon0,c_major,c_minor,t0,t_major,t_minor);
        }

        for (m=0;m<4;m++)
        {
            MKpolym[m] += polym[m];
        }
    }
    MKpolym[4] = seqlen/DIM;
    MKpolym[5] = idx;

    double _left_p,_right_p,pvalue;
    if (MKpolym[2]==0 || MKpolym[1]==0)
    {
        MKalpha[0] = MIN_ALPHA;
    }
    else
    {
        float tmp1 = (float) (MKpolym[3]*MKpolym[0]);
        float tmp2 = (float) (MKpolym[1]*MKpolym[2]);
        MKalpha[0] = (float) (1. - tmp1/tmp2);
    }

    fisher_exact(MKpolym[0],MKpolym[1],MKpolym[2],MKpolym[3],&_left_p,&_right_p,&pvalue);
    MKalpha[1] = (float) pvalue;
}



void asymMK_from_fasta(char *fasta_nm,char *name,char **sequence,char **headers,char *ingrp_nm,char **outgrp_nm,int nout,float cutoff,int *MKpolym,float *MKalpha,bool debug)
{

}
